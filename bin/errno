#!/usr/bin/env python
# -*- coding:UTF-8 -*-
"""Print the error message matching the given error code"

Usage example:
    $ for i in -i -n -s -in -is -ns -ins ; do errno -c $i 13 ; done
    EACCES
    13
    Permission denied
    EACCES = 13
    EACCES: Permission denied
    13: Permission denied
    EACCES = 13: Permission denied
"""
import argparse
import locale
import errno
import os


def errno_value(value):
    """Transform a string value representing an error number to an integer"""
    try:
        return int(value)
    except ValueError:
        pass
    if hasattr(errno, value):
        return getattr(errno, value)
    raise ValueError("Bad value", value)


if __name__ == '__main__':
    parser = argparse.ArgumentParser(
        description="Convert error codes to messages")
    parser.add_argument('errnos', metavar='ERRNO', nargs='+', type=errno_value,
                        help="error codes")
    parser.add_argument('-c', '--langc', action='store_true',
                        help="use C locale")
    parser.add_argument('-i', '--id', action='store_true',
                        help="find C identifier")
    parser.add_argument('-n', '--num', action='store_true',
                        help="give errnor number")
    parser.add_argument('-s', '--str', action='store_true',
                        help="show description string")
    args = parser.parse_args()

    # Set locale from environment variables if -c is not given
    locale.setlocale(locale.LC_ALL, 'C' if args.langc else '')

    # Enumerate all arguments
    for n in args.errnos:
        line = ''
        if args.id:
            if n not in errno.errorcode:
                line = '#' + str(n)
            elif args.num:
                line = errno.errorcode[n] + ' = ' + str(n)
            else:
                line = errno.errorcode[n]
        elif args.num:
            line = str(n)

        if args.str or not line:
            if line:
                line += ': '
            line += os.strerror(n)
        print(line)
