#!/bin/sh
# Define environment variables to customize the command line interface

# Ensure that all bin and sbin folders are in PATH, if they are not symlinks
COLON_PATH=":$PATH:"
for DIR in /usr/local/bin /usr/local/sbin /bin /usr/bin /sbin /usr/sbin ; do
    if [ ! -L "$DIR" -a -d "$DIR" -a "${COLON_PATH%:$DIR:*}" = "$COLON_PATH" ] ; then
        PATH="$DIR:$PATH"
    fi
done
export PATH
unset DIR

# Find real home directory
# Try sudo user
if [ -z "$REAL_HOME" ] && [ -n "$SUDO_USER" ] ; then
    REAL_HOME=$(getent passwd "$SUDO_USER" | cut -d: -f6)
fi
# Use current $HOME variable
if [ -z "$REAL_HOME" ] ; then
    REAL_HOME="$HOME"
fi
export REAL_HOME

# Set email address from .email file, if available
if [ -r "$REAL_HOME/.email" ] ; then
    read EMAIL < "$REAL_HOME/.email"
    export EMAIL
fi

# Add home in path
HOMEBIN="$REAL_HOME/bin"
if [ -d "$HOMEBIN" -a "${COLON_PATH%:$HOMEBIN:*}" = "$COLON_PATH" ] ; then
    export PATH="$HOMEBIN:$PATH"
fi
unset COLON_PATH HOMEBIN

# Python configuration
if [ -r "$REAL_HOME/.pythonrc" ] ; then
    export PYTHONSTARTUP="$REAL_HOME/.pythonrc"
fi

# Debian quilt configuration
if [ -r "$REAL_HOME/.quiltrc-dpkg" ] && type alias > /dev/null 2>&1 ; then
    alias dquilt="quilt --quiltrc=$REAL_HOME/.quiltrc-dpkg"
fi

# Prevent Erase in Line (EL) to Right (\33[K) in the colored output of grep.
# Please read grep man page for further information.
export GREP_COLORS='ne'

# Use Vim
if [ -x /usr/bin/vim ] || which vim > /dev/null 2>&1 ; then
    export EDITOR=vim
fi

# Use less
if [ -x /usr/bin/less ] || which less > /dev/null 2>&1 ; then
    # Force -R = --RAW-CONTROL-CHARS to have colors in less
    export LESS='-R'
    export LESSCOLOR='yes'
    export PAGER='less -R'
    # -R = --quit-if-one-screen, -X = --no-init
    export GIT_PAGER='less -RFX'
fi

# Make less more friendly for non-text input files, see lesspipe(1)
if [ -x /usr/bin/lesspipe ] ; then
    export LESSOPEN="| /usr/bin/lesspipe %s"
    export LESSCLOSE="/usr/bin/lesspipe %s %s"
fi

# Enable GCC colors (since GCC 4.8.0)
export GCC_COLORS=1
